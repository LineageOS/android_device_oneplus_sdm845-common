/*
 * Copyright (c) 2021 The LineageOS Project
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *      http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

package org.lineageos.dirac.gef;

import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.Intent;
import android.media.audiofx.AudioEffect;
import android.util.Log;
import android.util.Pair;

import java.util.ArrayList;
import java.util.UUID;

public class BootCompletedReceiver extends BroadcastReceiver {
    private static final String TAG = "OnePlusDiracGef";

    private static final UUID EFFECT_TYPE_DIRAC_GEF =
            UUID.fromString("3799d6d1-22c5-43c3-b3ec-d664cf8d2f0d");

    private static AudioEffect sAudioEffect;
    private static ArrayList<Pair<String, String>> sAudioEffectParameters;

    static {
        sAudioEffect = new AudioEffect(AudioEffect.EFFECT_TYPE_NULL, EFFECT_TYPE_DIRAC_GEF, 0, 0);
        sAudioEffectParameters = new ArrayList<>();
        sAudioEffectParameters.add(new Pair<>("47000100", "0800"));
        sAudioEffectParameters.add(new Pair<>("49000100", "0800"));
        sAudioEffectParameters.add(new Pair<>("46000100", "0880da8480011080da848001180f28c4d8022880f7022880ee052880dc0b30b0a20430b4a20430b5a20438e7da044001"));
        sAudioEffectParameters.add(new Pair<>("46000100", "0880da8480011080da848001180f28c4d8022880f7022880ee052880dc0b30b0a20430b4a20430b5a20438b5da044001"));
        sAudioEffectParameters.add(new Pair<>("46000100", "0881da8480011081da848001180a28c4d8022880f7022880ee052880dc0b30b0a20430b4a20430b5a20438e7da044001"));
        sAudioEffectParameters.add(new Pair<>("46000100", "0881da8480011081da848001180a28c4d8022880f7022880ee052880dc0b30b0a20430b4a20430b5a20438b5da044001"));
        sAudioEffectParameters.add(new Pair<>("46000100", "0880da8480011080da848001180f28c4d8022880f7022880ee052880dc0b30b0a20430b4a20430b5a2043880da044000"));
        sAudioEffectParameters.add(new Pair<>("46000100", "0880da8480011080da848001180f28c4d8022880f7022880ee052880dc0b30b0a20430b4a20430b5a2043880da044001"));
        sAudioEffectParameters.add(new Pair<>("46000100", "0880da8480011080da848001180f28c4d8022880f7022880ee052880dc0b30b0a20430b4a20430b5a204388080054001"));
        sAudioEffectParameters.add(new Pair<>("46000100", "0880da8480011080da848001180f28c4d8022880f7022880ee052880dc0b30b0a20430b4a20430b5a204388180054001"));
        sAudioEffectParameters.add(new Pair<>("46000100", "0880da8480011080da848001180f28c4d8022880f7022880ee052880dc0b30b0a20430b4a20430b5a204388280054001"));
        sAudioEffectParameters.add(new Pair<>("46000100", "0880da8480011080da848001180f28c4d8022880f7022880ee052880dc0b30b0a20430b4a20430b5a204388380054001"));
        sAudioEffectParameters.add(new Pair<>("46000100", "0880da8480011080da848001180f28c4d8022880f7022880ee052880dc0b30b0a20430b4a20430b5a204388480054001"));
        sAudioEffectParameters.add(new Pair<>("46000100", "0880da8480011080da848001180f28c4d8022880f7022880ee052880dc0b30b0a20430b4a20430b5a204388580054001"));
        sAudioEffectParameters.add(new Pair<>("46000100", "0880da8480011080da848001180f28c4d8022880f7022880ee052880dc0b30b0a20430b4a20430b5a204388680054001"));
        sAudioEffectParameters.add(new Pair<>("46000100", "0880da8480011080da848001180f28c4d8022880f7022880ee052880dc0b30b0a20430b4a20430b5a204388780054001"));
        sAudioEffectParameters.add(new Pair<>("46000100", "0880da8480011080da848001180f28c4d8022880f7022880ee052880dc0b30b0a20430b4a20430b5a204388880054001"));
        sAudioEffectParameters.add(new Pair<>("46000100", "0880da8480011080da848001180f28c4d8022880f7022880ee052880dc0b30b0a20430b4a20430b5a204388980054001"));
        sAudioEffectParameters.add(new Pair<>("45000100", "0880da8480011080da848001180f28c4d8022880f7022880ee052880dc0b30b0a20430b4a20430b5a204380042c801002d011000400100080000000000000000000000002d011001400100080000000000000000000000002d011002400100080000000000000000000000002d011003400100080000000000000000000000002d011004400100080000000000000000000000002d011005400100080000000000000000000000002d011006400100080000000000000000000000002d011007400100080000000000000000000000002d011008400100080000000000000000000000002d01100940010008000000000000000000000048c801"));
        sAudioEffectParameters.add(new Pair<>("46000100", "0881da8480011081da848001180a28c4d8022880f7022880ee052880dc0b30b0a20430b4a20430b5a204388080054001"));
        sAudioEffectParameters.add(new Pair<>("46000100", "0881da8480011081da848001180a28c4d8022880f7022880ee052880dc0b30b0a20430b4a20430b5a204388180054001"));
        sAudioEffectParameters.add(new Pair<>("46000100", "0881da8480011081da848001180a28c4d8022880f7022880ee052880dc0b30b0a20430b4a20430b5a204388280054001"));
        sAudioEffectParameters.add(new Pair<>("46000100", "0881da8480011081da848001180a28c4d8022880f7022880ee052880dc0b30b0a20430b4a20430b5a204388380054001"));
        sAudioEffectParameters.add(new Pair<>("46000100", "0881da8480011081da848001180a28c4d8022880f7022880ee052880dc0b30b0a20430b4a20430b5a204388480054001"));
        sAudioEffectParameters.add(new Pair<>("46000100", "0881da8480011081da848001180a28c4d8022880f7022880ee052880dc0b30b0a20430b4a20430b5a204388580054001"));
        sAudioEffectParameters.add(new Pair<>("46000100", "0881da8480011081da848001180a28c4d8022880f7022880ee052880dc0b30b0a20430b4a20430b5a204388680054001"));
        sAudioEffectParameters.add(new Pair<>("46000100", "0881da8480011081da848001180a28c4d8022880f7022880ee052880dc0b30b0a20430b4a20430b5a204388780054001"));
        sAudioEffectParameters.add(new Pair<>("46000100", "0881da8480011081da848001180a28c4d8022880f7022880ee052880dc0b30b0a20430b4a20430b5a204388880054001"));
        sAudioEffectParameters.add(new Pair<>("46000100", "0881da8480011081da848001180a28c4d8022880f7022880ee052880dc0b30b0a20430b4a20430b5a204388980054001"));
        sAudioEffectParameters.add(new Pair<>("45000100", "0881da8480011081da848001180a28c4d8022880f7022880ee052880dc0b30b0a20430b4a20430b5a204380042c801012d011000400100080000000000000000000000012d011001400100080000000000000000000000012d011002400100080000000000000000000000012d011003400100080000000000000000000000012d011004400100080000000000000000000000012d011005400100080000000000000000000000012d011006400100080000000000000000000000012d011007400100080000000000000000000000012d011008400100080000000000000000000000012d01100940010008000000000000000000000048c801"));
        sAudioEffectParameters.add(new Pair<>("44000100", "0800"));
        sAudioEffectParameters.add(new Pair<>("46000100", "0880da8480011080da848001180f28c4d8022880f7022880ee052880dc0b30b0a20430b4a20430b5a2043880da044000"));
        sAudioEffectParameters.add(new Pair<>("45000100", "0880da8480011080da848001180f28c4d8022880f7022880ee052880dc0b30b0a20430b4a20430b5a2043881da044204010000004804"));
        sAudioEffectParameters.add(new Pair<>("45000100", "0880da8480011080da848001180f28c4d8022880f7022880ee052880dc0b30b0a20430b4a20430b5a20438e7da044204000000004804"));
        sAudioEffectParameters.add(new Pair<>("45000100", "0880da8480011080da848001180f28c4d8022880f7022880ee052880dc0b30b0a20430b4a20430b5a20438b5da044204000000004804"));
        sAudioEffectParameters.add(new Pair<>("45000100", "0880da8480011080da848001180f28c4d8022880f7022880ee052880dc0b30b0a20430b4a20430b5a20438b6da04421c00000000000000000000000000000000000000000000000000000000481c"));
        sAudioEffectParameters.add(new Pair<>("46000100", "0880da8480011080da848001180f28c4d8022880f7022880ee052880dc0b30b0a20430b4a20430b5a2043880da044000"));
        sAudioEffectParameters.add(new Pair<>("45000100", "0881da8480011081da848001180a28c4d8022880f7022880ee052880dc0b30b0a20430b4a20430b5a2043881da044204000000004804"));
        sAudioEffectParameters.add(new Pair<>("45000100", "0880da8480011080da848001180f28c4d8022880f7022880ee052880dc0b30b0a20430b4a20430b5a20438004214002d0110004001000800000003000000000000004814"));
        sAudioEffectParameters.add(new Pair<>("45000100", "0881da8480011081da848001180a28c4d8022880f7022880ee052880dc0b30b0a20430b4a20430b5a20438004214012d0110014001000800000004000000000000004814"));
        sAudioEffectParameters.add(new Pair<>("45000100", "0880da8480011080da848001180f28c4d8022880f7022880ee052880dc0b30b0a20430b4a20430b5a20438004214002d0110004001000800000003000000000000004814"));
    }

    private static byte[] hexStringToByteArray(String s) {
        int len = s.length();
        byte[] data = new byte[len / 2];
        for (int i = 0; i < len; i += 2) {
            data[i / 2] = (byte) ((Character.digit(s.charAt(i), 16) << 4)
                    + Character.digit(s.charAt(i+1), 16));
        }
        return data;
    }

    @Override
    public void onReceive(final Context context, Intent intent) {
        Log.d(TAG, "Starting");
        for (Pair<String, String> parameter : sAudioEffectParameters) {
            sAudioEffect.setParameter(
                    hexStringToByteArray(parameter.first),
                    hexStringToByteArray(parameter.second));
        }
        sAudioEffect.setEnabled(true);
    }
}
